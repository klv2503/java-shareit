DROP TABLE IF EXISTS bookings;
DROP TABLE IF EXISTS comments;
DROP TABLE IF EXISTS items;
DROP TABLE IF EXISTS requests;
DROP TABLE IF EXISTS users;

CREATE TABLE IF NOT EXISTS users (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name VARCHAR(200) NOT NULL,
	email VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS requests (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	description VARCHAR(200),
	requestor_id BIGINT NOT NULL,
	created TIMESTAMP WITHOUT TIME ZONE NOT NULL,

    FOREIGN KEY (requestor_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS items (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name VARCHAR(50),
	description VARCHAR(200) NOT NULL,
	is_available BOOLEAN DEFAULT TRUE,
    owner_id BIGINT NOT NULL,
    request_id BIGINT,

    FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (request_id) REFERENCES requests(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS bookings (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	start_date TIMESTAMP WITHOUT TIME ZONE NOT NULL,
	end_date TIMESTAMP WITHOUT TIME ZONE NOT NULL,
	item_id BIGINT NOT NULL,
    booker_id BIGINT NOT NULL,
    status VARCHAR(10) NOT NULL DEFAULT 'WAITING',

    FOREIGN KEY (booker_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS comments (
    id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text VARCHAR(200) NOT NULL,
    item_id BIGINT NOT NULL,
    author_id BIGINT NOT NULL,
    created TIMESTAMP WITHOUT TIME ZONE NOT NULL,

    FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,
    FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE
);